{"version":3,"names":["PerformanceObserverEntryList","constructor","entries","getEntries","slice","getEntriesByType","type","filter","entry","entryType","getEntriesByName","name","SUPPORTED_ENTRY_TYPES","sortByStartTime","a","b","startTime","OBSERVER_TYPE_SINGLE","OBSERVER_TYPE_MULTIPLE","createPerformanceObserver","addEventListener","removeEventListener","PerformanceObserver","callback","takeRecords","entryTypes","has","buffer","push","scheduleEmission","timer","Set","observerType","requestAnimationFrame","emitRecords","observe","options","TypeError","Error","Array","isArray","buffered","console","warn","add","forEach","includes","receiveRecord","disconnect","cancelAnimationFrame","sort"],"sources":["performance-observer.ts"],"sourcesContent":["import type { EntryType, PerformanceEntry } from './performance-entry';\n\ntype ObserveOptionType1 = {\n  entryTypes: EntryType[];\n};\n\ntype ObserveOptionType2 = {\n  type: EntryType;\n  buffered?: boolean;\n};\n\nexport class PerformanceObserverEntryList {\n  entries: PerformanceEntry[];\n\n  constructor(entries: PerformanceEntry[]) {\n    this.entries = entries;\n  }\n\n  getEntries() {\n    return this.entries.slice(0);\n  }\n\n  getEntriesByType(type: EntryType) {\n    return this.entries.filter((entry) => entry.entryType === type);\n  }\n\n  getEntriesByName(name: string, type?: EntryType) {\n    return this.entries.filter(\n      (entry) => entry.name === name && (!type || entry.entryType === type)\n    );\n  }\n}\n\nconst SUPPORTED_ENTRY_TYPES = [\n  'mark',\n  'measure',\n  'metric',\n  'react-native-mark',\n  'resource',\n];\n\nconst sortByStartTime = (a, b) => a.startTime - b.startTime;\n\nconst OBSERVER_TYPE_SINGLE = 'single';\nconst OBSERVER_TYPE_MULTIPLE = 'multiple';\n\nexport const createPerformanceObserver = ({\n  addEventListener,\n  removeEventListener,\n  getEntriesByType,\n}) =>\n  class PerformanceObserver {\n    callback: (\n      list: PerformanceObserverEntryList,\n      observer: PerformanceObserver\n    ) => void;\n    buffer: PerformanceEntry[];\n    entryTypes: Set<EntryType>;\n    timer?: number;\n    observerType:\n      | null\n      | typeof OBSERVER_TYPE_SINGLE\n      | typeof OBSERVER_TYPE_MULTIPLE;\n\n    static supportedEntryTypes = SUPPORTED_ENTRY_TYPES;\n\n    constructor(\n      callback: (\n        list: PerformanceObserverEntryList,\n        observer: PerformanceObserver\n      ) => void\n    ) {\n      this.callback = callback;\n      this.buffer = [];\n      this.timer = null;\n      this.entryTypes = new Set();\n      this.observerType = null;\n    }\n\n    emitRecords = () => {\n      this.callback(new PerformanceObserverEntryList(this.takeRecords()), this);\n    };\n\n    scheduleEmission() {\n      if (this.timer === null) {\n        this.timer = requestAnimationFrame(() => {\n          this.timer = null;\n          this.emitRecords();\n        });\n      }\n    }\n\n    receiveRecord = (entry: PerformanceEntry) => {\n      if (this.entryTypes.has(entry.entryType)) {\n        this.buffer.push(entry);\n        this.scheduleEmission();\n      }\n    };\n\n    observe(options: ObserveOptionType1): void;\n    observe(options: ObserveOptionType2): void;\n\n    observe(options: any) {\n      if (!options || (!options.entryTypes && !options.type)) {\n        throw new TypeError(\n          \"Failed to execute 'observe' on 'PerformanceObserver': An observe() call must include either entryTypes or type arguments.\"\n        );\n      }\n      if (options.entryTypes && options.type) {\n        throw new TypeError(\n          \"Failed to execute 'observe' on 'PerformanceObserver': An observe() call must not include both entryTypes and type arguments.\"\n        );\n      }\n\n      if (options.entryTypes) {\n        if (this.observerType === OBSERVER_TYPE_SINGLE) {\n          throw new Error(\n            'This PerformanceObserver has performed observe({type:...}, therefore it cannot perform observe({entryTypes:...})'\n          );\n        }\n        if (!Array.isArray(options.entryTypes)) {\n          throw new TypeError('entryTypes argument must be an array');\n        }\n        this.observerType = OBSERVER_TYPE_MULTIPLE;\n        this.entryTypes = new Set(options.entryTypes);\n        this.buffer = [];\n        if (options.buffered) {\n          console.warn(\n            'The PerformanceObserver does not support buffered flag with the entryTypes argument.'\n          );\n        }\n      } else {\n        if (this.observerType === OBSERVER_TYPE_MULTIPLE) {\n          throw new Error(\n            'This PerformanceObserver has performed observe({entryTypes:...}, therefore it cannot perform observe({type:...})'\n          );\n        }\n        this.observerType = OBSERVER_TYPE_SINGLE;\n        this.entryTypes.add(options.type);\n        if (options.buffered) {\n          this.buffer = getEntriesByType(options.type);\n          this.scheduleEmission();\n        }\n      }\n\n      this.entryTypes.forEach((entryType) => {\n        if (!SUPPORTED_ENTRY_TYPES.includes(entryType)) {\n          console.warn(\n            `The entry type '${entryType}' does not exist or isn't supported.`\n          );\n        }\n      });\n\n      addEventListener(this.receiveRecord);\n    }\n\n    disconnect() {\n      removeEventListener(this.receiveRecord);\n      this.entryTypes = new Set();\n      this.observerType = null;\n      this.buffer = [];\n      if (this.timer !== null) {\n        cancelAnimationFrame(this.timer);\n        this.timer = null;\n      }\n    }\n\n    takeRecords() {\n      const entries = this.buffer.sort(sortByStartTime);\n      this.buffer = [];\n      return entries;\n    }\n  };\n"],"mappings":";;;;;;;;;AAWO,MAAMA,4BAAN,CAAmC;EAGxCC,WAAW,CAACC,OAAD,EAA8B;IAAA;;IACvC,KAAKA,OAAL,GAAeA,OAAf;EACD;;EAEDC,UAAU,GAAG;IACX,OAAO,KAAKD,OAAL,CAAaE,KAAb,CAAmB,CAAnB,CAAP;EACD;;EAEDC,gBAAgB,CAACC,IAAD,EAAkB;IAChC,OAAO,KAAKJ,OAAL,CAAaK,MAAb,CAAqBC,KAAD,IAAWA,KAAK,CAACC,SAAN,KAAoBH,IAAnD,CAAP;EACD;;EAEDI,gBAAgB,CAACC,IAAD,EAAeL,IAAf,EAAiC;IAC/C,OAAO,KAAKJ,OAAL,CAAaK,MAAb,CACJC,KAAD,IAAWA,KAAK,CAACG,IAAN,KAAeA,IAAf,KAAwB,CAACL,IAAD,IAASE,KAAK,CAACC,SAAN,KAAoBH,IAArD,CADN,CAAP;EAGD;;AAnBuC;;;AAsB1C,MAAMM,qBAAqB,GAAG,CAC5B,MAD4B,EAE5B,SAF4B,EAG5B,QAH4B,EAI5B,mBAJ4B,EAK5B,UAL4B,CAA9B;;AAQA,MAAMC,eAAe,GAAG,CAACC,CAAD,EAAIC,CAAJ,KAAUD,CAAC,CAACE,SAAF,GAAcD,CAAC,CAACC,SAAlD;;AAEA,MAAMC,oBAAoB,GAAG,QAA7B;AACA,MAAMC,sBAAsB,GAAG,UAA/B;;AAEO,MAAMC,yBAAyB,GAAG;EAAA;;EAAA,IAAC;IACxCC,gBADwC;IAExCC,mBAFwC;IAGxChB;EAHwC,CAAD;EAAA,gBAKvC,MAAMiB,mBAAN,CAA0B;IAexBrB,WAAW,CACTsB,QADS,EAKT;MAAA;;MAAA;;MAAA;;MAAA;;MAAA;;MAAA,qCAQY,MAAM;QAClB,KAAKA,QAAL,CAAc,IAAIvB,4BAAJ,CAAiC,KAAKwB,WAAL,EAAjC,CAAd,EAAoE,IAApE;MACD,CAVC;;MAAA,uCAqBehB,KAAD,IAA6B;QAC3C,IAAI,KAAKiB,UAAL,CAAgBC,GAAhB,CAAoBlB,KAAK,CAACC,SAA1B,CAAJ,EAA0C;UACxC,KAAKkB,MAAL,CAAYC,IAAZ,CAAiBpB,KAAjB;UACA,KAAKqB,gBAAL;QACD;MACF,CA1BC;;MACA,KAAKN,QAAL,GAAgBA,QAAhB;MACA,KAAKI,MAAL,GAAc,EAAd;MACA,KAAKG,KAAL,GAAa,IAAb;MACA,KAAKL,UAAL,GAAkB,IAAIM,GAAJ,EAAlB;MACA,KAAKC,YAAL,GAAoB,IAApB;IACD;;IAMDH,gBAAgB,GAAG;MACjB,IAAI,KAAKC,KAAL,KAAe,IAAnB,EAAyB;QACvB,KAAKA,KAAL,GAAaG,qBAAqB,CAAC,MAAM;UACvC,KAAKH,KAAL,GAAa,IAAb;UACA,KAAKI,WAAL;QACD,CAHiC,CAAlC;MAID;IACF;;IAYDC,OAAO,CAACC,OAAD,EAAe;MACpB,IAAI,CAACA,OAAD,IAAa,CAACA,OAAO,CAACX,UAAT,IAAuB,CAACW,OAAO,CAAC9B,IAAjD,EAAwD;QACtD,MAAM,IAAI+B,SAAJ,CACJ,2HADI,CAAN;MAGD;;MACD,IAAID,OAAO,CAACX,UAAR,IAAsBW,OAAO,CAAC9B,IAAlC,EAAwC;QACtC,MAAM,IAAI+B,SAAJ,CACJ,8HADI,CAAN;MAGD;;MAED,IAAID,OAAO,CAACX,UAAZ,EAAwB;QACtB,IAAI,KAAKO,YAAL,KAAsBf,oBAA1B,EAAgD;UAC9C,MAAM,IAAIqB,KAAJ,CACJ,kHADI,CAAN;QAGD;;QACD,IAAI,CAACC,KAAK,CAACC,OAAN,CAAcJ,OAAO,CAACX,UAAtB,CAAL,EAAwC;UACtC,MAAM,IAAIY,SAAJ,CAAc,sCAAd,CAAN;QACD;;QACD,KAAKL,YAAL,GAAoBd,sBAApB;QACA,KAAKO,UAAL,GAAkB,IAAIM,GAAJ,CAAQK,OAAO,CAACX,UAAhB,CAAlB;QACA,KAAKE,MAAL,GAAc,EAAd;;QACA,IAAIS,OAAO,CAACK,QAAZ,EAAsB;UACpBC,OAAO,CAACC,IAAR,CACE,sFADF;QAGD;MACF,CAjBD,MAiBO;QACL,IAAI,KAAKX,YAAL,KAAsBd,sBAA1B,EAAkD;UAChD,MAAM,IAAIoB,KAAJ,CACJ,kHADI,CAAN;QAGD;;QACD,KAAKN,YAAL,GAAoBf,oBAApB;QACA,KAAKQ,UAAL,CAAgBmB,GAAhB,CAAoBR,OAAO,CAAC9B,IAA5B;;QACA,IAAI8B,OAAO,CAACK,QAAZ,EAAsB;UACpB,KAAKd,MAAL,GAActB,gBAAgB,CAAC+B,OAAO,CAAC9B,IAAT,CAA9B;UACA,KAAKuB,gBAAL;QACD;MACF;;MAED,KAAKJ,UAAL,CAAgBoB,OAAhB,CAAyBpC,SAAD,IAAe;QACrC,IAAI,CAACG,qBAAqB,CAACkC,QAAtB,CAA+BrC,SAA/B,CAAL,EAAgD;UAC9CiC,OAAO,CAACC,IAAR,CACG,mBAAkBlC,SAAU,sCAD/B;QAGD;MACF,CAND;MAQAW,gBAAgB,CAAC,KAAK2B,aAAN,CAAhB;IACD;;IAEDC,UAAU,GAAG;MACX3B,mBAAmB,CAAC,KAAK0B,aAAN,CAAnB;MACA,KAAKtB,UAAL,GAAkB,IAAIM,GAAJ,EAAlB;MACA,KAAKC,YAAL,GAAoB,IAApB;MACA,KAAKL,MAAL,GAAc,EAAd;;MACA,IAAI,KAAKG,KAAL,KAAe,IAAnB,EAAyB;QACvBmB,oBAAoB,CAAC,KAAKnB,KAAN,CAApB;QACA,KAAKA,KAAL,GAAa,IAAb;MACD;IACF;;IAEDN,WAAW,GAAG;MACZ,MAAMtB,OAAO,GAAG,KAAKyB,MAAL,CAAYuB,IAAZ,CAAiBrC,eAAjB,CAAhB;MACA,KAAKc,MAAL,GAAc,EAAd;MACA,OAAOzB,OAAP;IACD;;EAxHuB,CALa,iDAkBRU,qBAlBQ;AAAA,CAAlC"}